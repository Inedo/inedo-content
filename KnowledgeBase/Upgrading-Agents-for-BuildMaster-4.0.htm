<!DOCTYPE html >
<html>
  <head>
    <meta name="id" content="1064" />
    <meta name="description" content="" />
    <meta name="keywords" content="buildmaster, agents" />
    <title>Upgrading Agents for BuildMaster 4.0</title>
  </head>
  <body>
      <p class="info">
          This document only applies to users upgrading from BuildMaster v3, and is a companion to <a href="/support/kb/1151">Upgrading from BuildMaster v3 and v4</a>.
      </p>
    <p>For BuildMaster 4.0, we have taken advantage of the major version change to make several breaking changes that prevent BuildMaster from automatically updating 3.x agents:</p>  <ul>   <li>BuildMaster Agents now require .NET 4.0 instead of .NET 2.0 </li>    <li>The WCF self-hosted SOAP agent (deprecated in favor of the TCP self-hosted agent) has been removed </li>    <li>The Linux Mono-based SOAP agent (deprecated in favor of SSH-based agents) has been removed </li> </ul>  <h3>Upgrading an IIS-Hosted SOAP Agent</h3>  <p>This type of agent is still officially supported, but will need a manual reinstallation:</p>  <ol>   <li>Uninstall the old agent from the remote server – <strong>do not delete it from the Servers page within BuildMaster</strong></li>    <li>Ensure that .NET 4 is installed and ASP.NET 4 has been registered with IIS </li>    <li>Install the new agent </li> </ol>  <h3></h3>  <h3>Upgrading a Self-Hosted TCP Agent</h3>  <p>This type of agent is still officially supported, but will need a manual reinstallation:</p>  <ol>   <li>Uninstall the old agent from the remote server – <strong>do not delete it from the Servers page within BuildMaster</strong></li>    <li>Ensure that .NET 4 is installed </li>    <li>Install the new agent – visit the <a href="/support/documentation/buildmaster/installation">documentation</a> on the subject for more information and tips for silent/scripted installation </li> </ol>  <h3>Upgrading a Self-Hosted SOAP (WCF) Agent</h3>  <p>This type of agent has been deprecated and removed from agent installers since BuildMaster 3.3, but BuildMaster continued to keep existing agents of this type up-to-date in versions prior to 4.0.</p>  <ol>   <li>Choose which type of agent to use instead. See <a href="http://inedo.com/support/kb/1039/comparison-of-buildmaster-agents">KB1039</a> for a comparison of the agent types. </li>    <li>Depending on which agent you have chosen, follow the steps in one of the above sections of this article to remove the old agent and install the new one. </li>    <li>Follow the &quot;Converting from Self-Hosted SOAP (WCF) to the Self-Hosted TCP Agent&quot; instructions below to change the agent type from BuildMaster's perspective. </li> </ol>  <h3>Upgrading a Linux Mono Agent</h3>  <p>This type of agent has been deprecated since BuildMaster 3.2 in favor of an SSH-based agent that requires no installed components on the Linux server.</p>  <ol>   <li>Remove the Mono agent from your Linux server. </li>    <li>Ensure that your server is configured to accept SSH connections. </li>    <li>Add an SSH-based agent to BuildMaster. </li> </ol>  <h2></h2>  <h2>Converting from Self-Hosted SOAP (WCF) to the Self-Hosted TCP Agent</h2>  <p>Because the self-hosted SOAP (WCF) agent has been removed in BuildMaster 4.0, it will need to be uninstalled and the new self-hosted TCP agent will need to be installed on the remote server as a replacement. <strong>Note: you should not delete the agents from within BuildMaster itself, otherwise you would need to update all deployment plans that rely on that server!</strong>&#160;</p>  <p>Once you have installed the new self-hosted TCP agent on the remote server, you will need to convert your agents on the BuildMaster side. To do so, visit the Administration overview page, and select &quot;Execute a System Recipe&quot;, choose the &quot;Change Agent Types (TCP-SOAP)&quot; option, and leave the default dropdown option of &quot;Agent Conversion Types: From SOAP to TCP Agent&quot;. By default, only SOAP agents are shown – so if you do not see the server in the list, it is already a TCP-based agent. <strong>Note: be sure to only choose servers with the self-hosted (i.e. Windows Service hosted) SOAP agents, if you are hosting your agents with IIS leave them unchecked so they remain SOAP agents.</strong>&#160;</p>  <p>Once you've selected the correct SOAP agents to convert, choose &quot;Convert Agents&quot; to convert them and return to the server overview page:</p>  <p><a href="/resources/knowledgebase/WindowsLiveWriter_UpgradingAgentsforBuildMaster4.0_BFD2_image_4.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="/resources/knowledgebase/WindowsLiveWriter_UpgradingAgentsforBuildMaster4.0_BFD2_image_thumb_1.png" width="680" height="218" /></a></p>  <p>Once converted, it can take up to a few minutes to update the server overview page because the status values on that page are cached. To check the live status of a server, select the server from the overview page, and examine the Agent Status section at the bottom of that page.</p>  <p><a href="/resources/knowledgebase/WindowsLiveWriter_UpgradingAgentsforBuildMaster4.0_BFD2_image_6.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="/resources/knowledgebase/WindowsLiveWriter_UpgradingAgentsforBuildMaster4.0_BFD2_image_thumb_2.png" width="463" height="329" /></a> </p>  <p>Also note that the &quot;Hosted&quot; property simply indicates that the type of agent (in this case, the self-hosted TCP-based agent) is a type of agent that is installed on the server – it does not know whether that is actually the case or not unless the &quot;Status&quot; field indicates something other than &quot;Error&quot; or &quot;Inactive&quot;.</p>  <h3>Troubleshooting Agents in ERROR Status</h3>  <p>Agents can be put in ERROR status for a variety of reasons, the most common are:</p>  <ul>   <li>The wrong type of agent is installed on the server – verify that the type of agent that BuildMaster identifies, is actually what is installed on the server (e.g. Self-hosted (TCP) Agent should have a service installed on the remote server, and IIS-hosted (SOAP) Agent should have a website configured in IIS on the remote server). This problem commonly results in error messages in the BuildMaster Error Log indicating such a problem.</li>    <li>For the self-hosted agent, the agent service (INEDOBMAGT) is not running</li>    <li>For the IIS-agent, either the hosting website or application pool are stopped</li>    <li>There is a firewall blocking the port of the agent</li>    <li>There is a newer agent installed on the remote server than the current installation of BuildMaster. Always make sure to match the version of the agent with that of the BuildMaster installation when freshly installing or manually upgrading the agent</li> </ul>  <h4>Testing connection to an IIS-Hosted (SOAP) agent:</h4>  <p>To test whether a SOAP agent is accessible by BuildMaster, browse to <strong>http://agent-server:port/agent.asmx</strong> from the BuildMaster server. If you see a page similar to the below image, the connection is available:</p>  <p><a href="/resources/knowledgebase/WindowsLiveWriter_UpgradingAgentsforBuildMaster4.0_BFD2_image_8.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="/resources/knowledgebase/WindowsLiveWriter_UpgradingAgentsforBuildMaster4.0_BFD2_image_thumb_3.png" width="550" height="138" /></a> </p>  <p>If you do not see this page, try connecting locally from the agent server itself – this will indicate whether the network is the culprit.</p>  <h4>Testing connection to a Self-Hosted (TCP) agent:</h4>  <p>To whether a TCP agent is accessible by BuildMaster, open a telnet session to the server and port:</p>  <p>telnet agent-server [port]</p>  <p>If the connection is successful, there will be a blank prompt and you can send text to the agent. If the connection is unsuccessful, you would see an error message similar to: &quot;Connecting To agent-server...Could not open connection to the host, on port 1000: Connect failed&quot;.</p></body>
</html>